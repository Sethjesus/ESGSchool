<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ’§ æ°´ï¼šç”¨æ°´èˆ‡ç’°å¢ƒï¼ˆäº’å‹•å¢å¼·ç‰ˆï¼‰</title>
  <style>
    :root{
      --bg:#fdfdfd; --fg:#222; --muted:#475569; --card:#fff; --shadow:0 4px 12px rgba(0,0,0,.05);
      --brand:#1e90ff; --brand-ink:#0f172a; --soft:#f4f4f4; --hero-mask:rgba(0,0,0,.45);
    }
    body.dark{
      --bg:#0b1220; --fg:#e5e7eb; --muted:#9aa4b2; --card:#0f172a; --shadow:0 4px 16px rgba(0,0,0,.35);
      --brand:#60a5fa; --brand-ink:#e5e7eb; --soft:#111826; --hero-mask:rgba(0,0,0,.55);
    }

    *{box-sizing:border-box}
    body{font-family:"Microsoft JhengHei",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; margin:0; background:var(--bg); color:var(--fg); transition:background .3s,color .3s}
    a{color:inherit}
    nav{background:var(--soft); padding:10px; display:flex; justify-content:space-between; align-items:center; gap:12px; position:sticky; top:0; z-index:10; box-shadow:0 2px 8px rgba(0,0,0,.06)}
    nav .brand{font-weight:700; color:var(--brand)}
    nav a{color:var(--fg); text-decoration:none; margin-left:12px}
    main{max-width:1080px; margin:24px auto; padding:0 16px}
    h1{margin:8px 0 16px; color:var(--brand-ink)}
    p{line-height:1.75}

    .section{margin-top:40px; padding:20px; border-radius:12px; box-shadow:var(--shadow); background:var(--card)}
    .muted{font-size:13px; color:var(--muted)}

    .cards{display:grid; gap:16px; margin-top:18px; grid-template-columns:repeat(auto-fit,minmax(220px,1fr));}
    .card{background:var(--card); padding:14px; border-radius:12px; display:flex; gap:12px; align-items:center; box-shadow:var(--shadow); transition:transform .3s ease}
    .card:hover{transform:translateY(-2px)}
    .card .i{font-size:28px}
    .card .t{font-weight:700}

    /* Gallery */
    .gallery{margin-top:16px; display:grid; gap:16px; grid-template-columns:repeat(2,minmax(0,1fr));}
    @media (max-width:720px){ .gallery{grid-template-columns:1fr;} }
    .tile{position:relative; border-radius:12px; overflow:hidden; box-shadow:0 10px 24px rgba(0,0,0,.08); background:#000; cursor:pointer}
    body.dark .tile{box-shadow:0 10px 24px rgba(0,0,0,.45)}
    .tile .frame{width:100%; aspect-ratio:16/10; overflow:hidden}
    .tile img{width:100%; height:100%; object-fit:cover; transition:transform .35s ease}
    .tile:hover img{transform:scale(1.05)}
    .tile .cap{position:absolute; left:0; right:0; bottom:0; background:rgba(0,0,0,.5); color:#fff; padding:10px 12px; font-weight:700; text-align:center}

    /* Filter bar */
    .filterbar{display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin:12px 0 6px}
    .filterbar input[type="search"]{flex:1 1 260px; padding:9px 12px; border-radius:10px; border:1px solid #0000; background:var(--soft); color:var(--fg)}
    .chip{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:var(--soft); color:var(--fg); cursor:pointer; user-select:none}
    .btn{border:1px solid #0000; background:var(--card); color:var(--fg); padding:8px 10px; border-radius:10px; box-shadow:var(--shadow); cursor:pointer}
    .btn:hover{filter:brightness(1.05)}

    /* Lightbox */
    .lightbox{position:fixed; inset:0; background:rgba(0,0,0,.85); display:none; align-items:center; justify-content:center; z-index:50}
    .lightbox.open{display:flex}
    .lightbox .inner{max-width:min(92vw,1100px); max-height:90vh; position:relative}
    .lightbox img{width:100%; height:auto; max-height:90vh; object-fit:contain; border-radius:12px; box-shadow:0 12px 36px rgba(0,0,0,.4)}
    .lightbox .txt{position:absolute; left:0; right:0; bottom:0; background:rgba(0,0,0,.5); color:#fff; padding:10px 14px; border-radius:0 0 12px 12px; text-align:center}
    .lightbox .close{position:absolute; top:-12px; right:-12px; width:40px; height:40px; border:none; border-radius:50%; background:rgba(255,255,255,.9); cursor:pointer; font-size:20px}
    .lightbox .close:hover{background:#fff}
    .lightbox .navBtn{position:absolute; top:50%; transform:translateY(-50%); border:none; background:rgba(255,255,255,.9); width:44px; height:44px; border-radius:50%; cursor:pointer; font-size:18px}
    .lightbox .prev{left:-12px}
    .lightbox .next{right:-12px}
    .lightbox .actions{position:absolute; top:-52px; left:0; right:0; display:flex; gap:8px; justify-content:center}

    /* Hero */
    .hero{margin-top:50px; position:relative; border-radius:12px; overflow:hidden; box-shadow:0 8px 24px rgba(0,0,0,.15)}
    .hero img{width:100%; height:auto; display:block; animation:zoomIn 20s ease-in-out infinite alternate}
    .hero-text{position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:var(--hero-mask); color:#fff; padding:16px 22px; border-radius:12px; text-align:center; font-size:1.4em; font-weight:700; animation:floatText 4s ease-in-out infinite}
    .hero-edit{position:absolute; right:12px; bottom:12px}
    .hero-edit input{padding:8px 10px; border-radius:10px; border:1px solid #0000; background:rgba(255,255,255,.9)}
    @keyframes zoomIn{from{transform:scale(1)} to{transform:scale(1.08)}}
    @keyframes floatText{0%,100%{transform:translate(-50%,-50%) translateY(0)} 50%{transform:translate(-50%,-50%) translateY(-10px)}}

    /* Tools grid */
    .tools{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:16px}
    .tool{background:var(--card); border-radius:12px; padding:16px; box-shadow:var(--shadow)}
    .tool h3{margin:0 0 10px}
    .tool .row{display:flex; gap:10px; align-items:center; margin:8px 0}

    /* Checklist */
    .checklist .item{display:flex; align-items:center; gap:10px; margin:8px 0}
    .progress{height:10px; background:var(--soft); border-radius:999px; overflow:hidden; margin-top:8px}
    .progress > span{display:block; height:100%; background:linear-gradient(90deg,#22c55e,#16a34a); width:0%}

    /* Back to top */
    .to-top{position:fixed; right:16px; bottom:16px; width:44px; height:44px; display:grid; place-items:center; border-radius:50%; background:var(--brand); color:#fff; box-shadow:0 6px 22px rgba(0,0,0,.25); cursor:pointer; opacity:0; transform:translateY(20px); transition:all .25s}
    .to-top.show{opacity:1; transform:translateY(0)}

    /* === Switchï¼ˆ44x24ï¼Œèˆ‡å…¶ä»–é ä¸€è‡´ï¼‰ === */
    .switch{margin-left:16px; position:relative; display:inline-block; width:44px; height:24px; vertical-align:middle;}
    .switch input{opacity:0; width:0; height:0}
    .slider{position:absolute; cursor:pointer; inset:0; background:#ccc; transition:.4s; border-radius:24px}
    .slider:before{position:absolute; content:""; height:18px; width:18px; left:3px; bottom:3px; background:#fff; transition:.4s; border-radius:50%}
    .switch input:checked + .slider{background:#1e90ff}
    .switch input:checked + .slider:before{transform:translateX(20px)}
    .switch-text{margin-left:8px; font-size:14px; color:var(--fg); cursor:pointer; user-select:none; vertical-align:middle;}
  </style>
</head>
<body>
  <nav>
    <div class="brand">ğŸ“˜ UDM ESG æ°¸çºŒæ•™ç§‘æ›¸</div>
    <div>
      <a href="index.html">ğŸ  é¦–é </a>
      <a href="sunshine.html">ğŸŒ é™½å…‰</a>
      <a href="air.html">ğŸ’¨ ç©ºæ°£</a>
      <a href="water.html">ğŸ’§ æ°´</a>
      <a href="carbon.html">ğŸŒ± ç¢³åŒ¯</a>
      <!-- æ·±è‰²é–‹é—œï¼ˆçµ±ä¸€æ¨£å¼èˆ‡ä½ç½®ï¼‰ -->
      <label class="switch">
        <input type="checkbox" id="darkToggle" aria-label="åˆ‡æ›æ·±è‰²æ¨¡å¼">
        <span class="slider"></span>
      </label>
      <label class="switch-text" for="darkToggle">æ·±è‰²</label>
    </div>
  </nav>

  <main>
    <h1>ğŸ’§ æ°´ï¼šç”¨æ°´èˆ‡ç’°å¢ƒ</h1>
    <p>äº†è§£ç”¨æ°´è¡Œç‚ºèˆ‡æ°´è³‡æºä¿è­·ï¼Œå¾æ ¡åœ’èˆ‡å®¶åº­ä¸€èµ·åšåˆ°ç¯€æ°´èˆ‡è­·æ°´ã€‚</p>

    <!-- åœ–ç‰‡åœ–å¡ï¼ˆé slideï¼‰ï¼šw1~w4 -->
    <section class="section">
      <h2 style="margin:0 0 6px;">ğŸ“· ç”¨æ°´è¨­å‚™åœ–é›†</h2>
      <div class="muted">é»åœ–å¯æ”¾å¤§ã€å·¦å³æ–¹å‘éµåˆ‡æ›ã€æ”¯æ´æœå°‹/ç¯©é¸ã€‚</div>

      <!-- Filter/Searchï¼ˆæŠŠéš¨æ©ŸæŒ‰éˆ•ç§»åˆ°é€™è£¡ï¼Œé¿å…ä½”ç”¨ navï¼‰ -->
      <div class="filterbar">
        <input type="search" id="search" placeholder="æœå°‹ï¼šè«‹ç”¨ä¸­è‹±æ–‡é—œéµå­—æˆ–æ¨™ç±¤ å¦‚ï¼šæ™ºæ…§æ°´è¡¨,meter, gateway, dashboard,display",>
        <span class="chip" data-filter="all">å…¨éƒ¨</span>
        <span class="chip" data-filter="meter">æ™ºæ…§æ°´è¡¨</span>
        <span class="chip" data-filter="display">é¡¯ç¤ºå™¨</span>
        <span class="chip" data-filter="gateway">é–˜é“å™¨</span>
        <span class="chip" data-filter="dashboard">å„€éŒ¶æ¿</span>
        <button class="btn" id="shuffleBtn" title="éš¨æ©Ÿæ’åˆ—åœ–åº«">ğŸ”€ éš¨æ©Ÿ</button>
      </div>

      <div class="gallery" id="gallery">
        <figure class="tile" data-cap="æ™ºæ…§æ°´è¡¨ï¼ˆmeterï¼‰" data-tags="meter,hardware">
          <div class="frame"><img src="w1.png" alt="æ™ºæ…§æ°´è¡¨"></div>
          <figcaption class="cap">æ™ºæ…§æ°´è¡¨</figcaption>
        </figure>
        <figure class="tile" data-cap="ç”¨æ°´é¡¯ç¤ºå™¨ï¼ˆdisplay moduleï¼‰" data-tags="display,hardware">
          <div class="frame"><img src="w2.png" alt="ç”¨æ°´é¡¯ç¤ºå™¨"></div>
          <figcaption class="cap">ç”¨æ°´é¡¯ç¤ºå™¨</figcaption>
        </figure>
        <figure class="tile" data-cap="Gatewayï¼ˆé€šè¨ŠåŒ¯æµï¼‰" data-tags="gatewayé–˜é“å™¨,network">
          <div class="frame"><img src="w3.png" alt="Gateway"></div>
          <figcaption class="cap">Gateway</figcaption>
        </figure>
        <figure class="tile" data-cap="ç”¨æ°´é›»å„€è¡¨æ¿ï¼ˆdashboardï¼‰" data-tags="dashboard,ui">
          <div class="frame"><img src="w4.png" alt="ç”¨æ°´é›»å„€è¡¨æ¿"></div>
          <figcaption class="cap">ç”¨æ°´é›»å„€è¡¨æ¿</figcaption>
        </figure>
      </div>
    </section>

    <!-- ç¯€æ°´çš„é‡è¦æ€§ï¼‹äº’å‹•å¡ç‰‡ -->
    <section class="section" style="background:linear-gradient(180deg,rgba(56,189,248,.08),transparent)">
      <h2>ğŸ’¡ ç¯€ç´„ç”¨æ°´çš„é‡è¦æ€§</h2>
      <p class="muted">æ¸…æ½”å¯ç”¨çš„æ·¡æ°´æœ‰é™ï¼›ç¯€æ°´èƒ½æ¸›å°‘æŠ½å–èˆ‡æ·¨åŒ–èƒ½è€—ï¼Œä¹Ÿå°±é–“æ¥é™ä½ç¢³æ’ã€‚æ ¡åœ’èˆ‡å®¶åº­åªè¦æ”¹è®Šå°ç¿’æ…£ï¼Œå°±èƒ½å®ˆè­·æ²³å·èˆ‡ç”Ÿæ…‹ç³»ã€‚</p>
      <div class="cards">
        <div class="card"><div class="i">ğŸš¿</div><div><div class="t">çŸ­æ™‚é–“æ·‹æµ´</div><div class="muted">æ§åˆ¶åœ¨ 5â€“8 åˆ†é˜ï¼Œçœæ°´åˆçœèƒ½</div></div></div>
        <div class="card"><div class="i">ğŸ§¼</div><div><div class="t">é—œæ°´æ“æ´—</div><div class="muted">æ´—æ‰‹æ´—ç¢—æ™‚é—œæ°´ï¼Œæ²–æ´—å†é–‹</div></div></div>
        <div class="card"><div class="i">ğŸ› ï¸</div><div><div class="t">ä¿®æ¼æª¢æ¸¬</div><div class="muted">å®šæœŸæª¢æŸ¥æ°´é¾é ­èˆ‡é¦¬æ¡¶æ¼æ°´</div></div></div>
        <div class="card"><div class="i">â™»ï¸</div><div><div class="t">å›æ”¶å†åˆ©ç”¨</div><div class="muted">æ”¶é›†æ´—èœæ°´æ¾†èŠ±æ‹–åœ°</div></div></div>
      </div>
    </section>

    <!-- å°å·¥å…·ï¼šç”¨æ°´è©¦ç®— + ç›®æ¨™æ¸…å–® -->
    <section class="section">
      <h2>ğŸ§ª äº’å‹•å·¥å…·</h2>
      <div class="tools">
        <!-- Calculator -->
        <div class="tool" id="calc">
          <h3>å³æ™‚ç”¨æ°´è©¦ç®—ï¼ˆä¼°ç®—ï¼‰</h3>
          <div class="muted">å¯ä¾å¯¦éš›æƒ…æ³èª¿æ•´åƒæ•¸ï¼›çµæœåƒ…ä¾›æ•™è‚²åƒè€ƒã€‚</div>
          <div class="row"><label style="width:140px">æ·‹æµ´åˆ†é˜æ•¸ï¼š</label><input type="range" id="showerMin" min="0" max="20" value="6"><span id="showerMinVal">6</span> åˆ†</div>
          <div class="row"><label style="width:140px">æ°´é¾é ­åˆ†é˜æ•¸ï¼š</label><input type="range" id="tapMin" min="0" max="30" value="5"><span id="tapMinVal">5</span> åˆ†</div>
          <div class="row"><label style="width:140px">é¦¬æ¡¶æ²–æ°´æ¬¡æ•¸ï¼š</label><input type="range" id="flushCnt" min="0" max="20" value="5"><span id="flushCntVal">5</span> æ¬¡</div>
          <div class="row"><label style="width:140px">æ¯ mÂ³ ç¢³ä¿‚æ•¸ï¼š</label><input type="number" id="co2Factor" step="0.01" value="0.16" style="width:90px"> kg COâ‚‚e/mÂ³</div>
          <div class="row"><button class="btn" id="calcBtn">è¨ˆç®—</button><button class="btn" id="resetCalc">é‡ç½®</button></div>
          <div id="calcOut" class="muted"></div>
        </div>

        <!-- Checklist with progress -->
        <div class="tool checklist" id="cl">
          <h3>ç¯€æ°´è¡Œå‹•æ¸…å–®</h3>
          <div class="item"><input type="checkbox" data-k="a"> æ¸›å°‘æ·‹æµ´æ™‚é–“è‡³ 8 åˆ†é˜å…§</div>
          <div class="item"><input type="checkbox" data-k="b"> æ´—æ‰‹åˆ·ç‰™é—œæ°´æ“æ´—</div>
          <div class="item"><input type="checkbox" data-k="c"> ä¿®å¾©æ»´æ°´æ°´é¾é ­/é¦¬æ¡¶</div>
          <div class="item"><input type="checkbox" data-k="d"> å›æ”¶æ´—èœæ°´æ¾†èŠ±</div>
          <div class="progress" aria-label="å®Œæˆåº¦"><span id="clBar"></span></div>
          <div class="muted" id="clInfo">å®Œæˆåº¦ 0%</div>
        </div>
      </div>
    </section>

    <!-- æœ€åº•éƒ¨ Hero -->
    <section class="hero">
      <img src="w5.png" alt="ç¯€æ°´è¡Œå‹•">
      <div class="hero-text" id="waterHeroText">ğŸ’§ ç¯€æ°´</div>
      <div class="hero-edit">
        <input id="heroInput" type="text" placeholder="è‡ªè¨‚æ¨™èªï¼ˆæŒ‰ Enter å„²å­˜ï¼‰">
      </div>
    </section>
  </main>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="inner">
      <div class="actions">
        <button class="btn" id="dlBtn" title="ä¸‹è¼‰ç›®å‰åœ–ç‰‡">â¬‡ï¸ ä¸‹è¼‰</button>
        <button class="btn" id="openNew" title="åœ¨æ–°åˆ†é é–‹å•Ÿ">ğŸ—” æ–°åˆ†é </button>
      </div>
      <button class="navBtn prev" id="lbPrev" aria-label="ä¸Šä¸€å¼µ">âŸ¨</button>
      <button class="navBtn next" id="lbNext" aria-label="ä¸‹ä¸€å¼µ">âŸ©</button>
      <button class="close" aria-label="é—œé–‰">âœ•</button>
      <img id="lbImg" alt="">
      <div class="txt" id="lbTxt"></div>
    </div>
  </div>

  <button class="to-top" id="toTop" title="å›åˆ°é ‚éƒ¨">â†‘</button>

  <script>
    // ===== æ·±è‰²é–‹é—œï¼ˆçµ±ä¸€ï¼šbody.dark + localStorage 'udm_theme'ï¼‰=====
    (function(){
      const KEY='udm_theme';
      const cb=document.getElementById('darkToggle');
      if(!cb) return;
      const saved=localStorage.getItem(KEY);
      if(saved==='dark'){ document.body.classList.add('dark'); cb.checked=true; }
      cb.addEventListener('change',()=>{
        const dark=cb.checked;
        document.body.classList.toggle('dark',dark);
        localStorage.setItem(KEY, dark ? 'dark' : 'light');
      });
    })();

    // ===== Shuffle gallery =====
    (function(){
      const btn = document.getElementById('shuffleBtn');
      const g = document.getElementById('gallery');
      btn.addEventListener('click',()=>{
        const items = Array.from(g.children);
        for(let i=items.length-1;i>0;i--){
          const j = Math.floor(Math.random()*(i+1));
          g.appendChild(items[j]); items.splice(j,1);
        }
      });
    })();

    // ===== Filter + search =====
    (function(){
      const chips = document.querySelectorAll('.chip[data-filter]');
      const q = document.getElementById('search');
      const tiles = Array.from(document.querySelectorAll('.tile'));
      let activeTag = 'all';
      function apply(){
        const s = q.value.trim().toLowerCase();
        tiles.forEach(t=>{
          const tags = (t.getAttribute('data-tags')||'').toLowerCase();
          const cap = (t.getAttribute('data-cap')||'').toLowerCase();
          const showByTag = (activeTag==='all') || tags.includes(activeTag);
          const showByText = !s || tags.includes(s) || cap.includes(s);
          t.style.display = (showByTag && showByText)?'block':'none';
        });
      }
      chips.forEach(c=>c.addEventListener('click',()=>{activeTag=c.dataset.filter; apply();}));
      q.addEventListener('input',apply);
    })();

    // ===== Lightbox with nav / keys / swipe =====
    (function(){
      const box = document.getElementById('lightbox');
      const img = document.getElementById('lbImg');
      const txt = document.getElementById('lbTxt');
      const closeBtn = box.querySelector('.close');
      const tiles = Array.from(document.querySelectorAll('.tile'));
      const prev = document.getElementById('lbPrev');
      const next = document.getElementById('lbNext');
      const dlBtn = document.getElementById('dlBtn');
      const openNew = document.getElementById('openNew');
      let idx = 0;

      function open(i){
        idx = i;
        const el = tiles[idx].querySelector('img');
        img.src = el.getAttribute('src');
        img.alt = el.getAttribute('alt')||'';
        txt.textContent = tiles[idx].getAttribute('data-cap') || el.getAttribute('alt') || '';
        box.classList.add('open');
        box.setAttribute('aria-hidden','false');
      }
      function close(){ box.classList.remove('open'); box.setAttribute('aria-hidden','true'); img.src=''; }
      function step(d){
        const visible = tiles.filter(t=>t.style.display!=="none");
        const current = visible.indexOf(tiles[idx]);
        const target = (current+d+visible.length)%visible.length;
        const newIdx = tiles.indexOf(visible[target]);
        open(newIdx);
      }

      tiles.forEach((t,i)=> t.addEventListener('click',()=> open(i)));
      closeBtn.addEventListener('click', close);
      box.addEventListener('click', (e)=>{ if(e.target===box) close(); });
      document.addEventListener('keydown', (e)=>{
        if(!box.classList.contains('open')) return;
        if(e.key==='Escape') close();
        if(e.key==='ArrowLeft') step(-1);
        if(e.key==='ArrowRight') step(1);
      });
      prev.addEventListener('click',()=>step(-1));
      next.addEventListener('click',()=>step(1));

      // swipe
      let sx=0, sy=0;
      box.addEventListener('touchstart',e=>{sx=e.touches[0].clientX; sy=e.touches[0].clientY});
      box.addEventListener('touchend',e=>{
        const dx=e.changedTouches[0].clientX-sx; const dy=e.changedTouches[0].clientY-sy;
        if(Math.abs(dx)>50 && Math.abs(dx)>Math.abs(dy)) step(dx>0?-1:1);
      });

      // actions
      dlBtn.addEventListener('click',()=>{
        const a=document.createElement('a'); a.href=img.src; a.download=img.alt||'image'; a.click();
      });
      openNew.addEventListener('click',()=>{ window.open(img.src,'_blank'); });
    })();

    // ===== Hero æ¨™èªè¼ªæ’­ ï¼‹ è‡ªè¨‚ä¿å­˜ =====
    ;(function(){
      const msgs = ["ğŸ’§ ç¯€æ°´", "ğŸ«§ æ·¨æ°´", "ğŸï¸ å¥½ç’°å¢ƒ"]; let i = 0;
      const el = document.getElementById('waterHeroText');
      const key = 'udm_water_hero';
      const saved = localStorage.getItem(key);
      if(saved){ el.textContent = saved; }
      setInterval(()=>{
        if(localStorage.getItem(key)) return; // è‹¥ä½¿ç”¨è€…è‡ªè¨‚å‰‡åœç”¨è¼ªæ’­
        i=(i+1)%msgs.length; el.textContent = msgs[i];
      }, 3000);
      const input = document.getElementById('heroInput');
      input.addEventListener('keydown', (e)=>{
        if(e.key==='Enter'){
          const v = input.value.trim();
          if(v){ el.textContent=v; localStorage.setItem(key,v); input.value=''; }
        }
      });
    })();

    // ===== è©¦ç®—å™¨ =====
    (function(){
      const showerMin = document.getElementById('showerMin');
      const tapMin = document.getElementById('tapMin');
      const flushCnt = document.getElementById('flushCnt');
      const f1 = document.getElementById('showerMinVal');
      const f2 = document.getElementById('tapMinVal');
      const f3 = document.getElementById('flushCntVal');
      const out = document.getElementById('calcOut');
      const factor = document.getElementById('co2Factor');
      const btn = document.getElementById('calcBtn');
      const reset = document.getElementById('resetCalc');

      const sync = ()=>{ f1.textContent=showerMin.value; f2.textContent=tapMin.value; f3.textContent=flushCnt.value; };
      [showerMin,tapMin,flushCnt].forEach(el=>el.addEventListener('input',sync)); sync();

      function calc(){
        // åŸºæœ¬å‡è¨­ï¼ˆå¯è‡ªè¡Œèª¿æ•´ï¼‰ï¼š
        const showerLpm = 9;   // æ·‹æµ´å‡ºæ°´é‡ (L/åˆ†)
        const tapLpm = 6;      // æ°´é¾é ­å‡ºæ°´é‡ (L/åˆ†)
        const flushL = 6;      // é¦¬æ¡¶æ¯æ¬¡ç”¨æ°´ (L)
        const L = showerLpm*+showerMin.value + tapLpm*+tapMin.value + flushL*+flushCnt.value;
        const m3 = L/1000;
        const co2 = m3 * (+factor.value||0);
        out.innerHTML = `ä¼°ç®—ç”¨æ°´ï¼š<b>${L.toFixed(0)}</b> Lï¼ˆç´„ <b>${m3.toFixed(2)}</b> mÂ³ï¼‰ï½œä¼°ç®—ç¢³æ’ï¼š<b>${co2.toFixed(2)}</b> kg COâ‚‚e`;
      }
      btn.addEventListener('click',calc);
      reset.addEventListener('click',()=>{ showerMin.value=6; tapMin.value=5; flushCnt.value=5; factor.value=0.16; sync(); out.textContent=''; });
    })();

    // ===== Checklist with progress + localStorage =====
    (function(){
      const key='udm_water_checklist';
      const state = JSON.parse(localStorage.getItem(key)||'{}');
      const boxes = Array.from(document.querySelectorAll('#cl input[type="checkbox"]'));
      const bar = document.getElementById('clBar');
      const info = document.getElementById('clInfo');

      boxes.forEach(b=>{ if(state[b.dataset.k]) b.checked=true; });
      function refresh(){
        const done = boxes.filter(b=>b.checked).length;
        const pct = Math.round(done/boxes.length*100);
        bar.style.width=pct+'%';
        info.textContent = `å®Œæˆåº¦ ${pct}%`;
        if(pct===100){ confetti(); }
      }
      boxes.forEach(b=> b.addEventListener('change',()=>{ state[b.dataset.k]=b.checked; localStorage.setItem(key,JSON.stringify(state)); refresh(); }));
      refresh();

      // ç°¡æ˜“ confettiï¼ˆç„¡å¤–éƒ¨å¥—ä»¶ï¼‰
      function confetti(){
        for(let i=0;i<60;i++){
          const s=document.createElement('span');
          s.textContent='ğŸ‰'; s.style.position='fixed'; s.style.left=Math.random()*100+'vw'; s.style.top='-10px'; s.style.fontSize=(16+Math.random()*16)+'px'; s.style.transition='transform 2.2s ease, opacity 2.2s ease'; s.style.zIndex=99; document.body.appendChild(s);
          setTimeout(()=>{ s.style.transform=`translateY(${120+Math.random()*80}vh) rotate(${(Math.random()*360)|0}deg)`; s.style.opacity='0'; }, 10);
          setTimeout(()=> s.remove(), 2400);
        }
      }
    })();

    // ===== Back to top =====
    (function(){
      const b = document.getElementById('toTop');
      window.addEventListener('scroll',()=>{
        if(window.scrollY>300){ b.classList.add('show'); } else { b.classList.remove('show'); }
      });
      b.addEventListener('click',()=> window.scrollTo({top:0, behavior:'smooth'}));
    })();
  </script>
</body>
</html>
