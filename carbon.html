<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🌱 碳匯：固碳原理與公式</title>
  <style>
    body{font-family:"Microsoft JhengHei",sans-serif; margin:0; background:#fdfdfd; color:#222; transition:background .3s, color .3s;}
    body.dark{background:#1e293b; color:#f1f5f9;}
    nav{background:#f4f4f4; padding:10px; display:flex; justify-content:space-between; align-items:center;}
    body.dark nav{background:#0f172a;}
    nav a{color:#333; text-decoration:none; margin-left:12px;}
    body.dark nav a{color:#f1f5f9;}
    nav .brand{font-weight:700; color:#1e90ff}
    main{max-width:1080px; margin:24px auto; padding:0 16px;}
    h1{margin:8px 0 16px; color:#2c3e50}
    h2{margin:28px 0 10px; color:#2c3e50}
    p{line-height:1.75}
    ul{line-height:1.7}

    /* Switch */
    .switch{margin-left:16px; position:relative; display:inline-block; width:44px; height:24px; vertical-align:middle;}
    .switch input{opacity:0; width:0; height:0;}
    .slider{position:absolute; cursor:pointer; inset:0; background:#ccc; transition:.4s; border-radius:24px;}
    .slider:before{position:absolute; content:""; height:18px; width:18px; left:3px; bottom:3px; background:white; transition:.4s; border-radius:50%;}
    input:checked + .slider{background:#1e90ff;}
    input:checked + .slider:before{transform:translateX(20px);}

    /* switch 文字（可點擊） */
    .switch-text{margin-left:8px; font-size:14px; color:#333; cursor:pointer; user-select:none; vertical-align:middle;}
    body.dark .switch-text{color:#f1f5f9;}

    /* Carousel */
    .carousel{position:relative; border-radius:12px; overflow:hidden; box-shadow:0 8px 20px rgba(0,0,0,.07);}
    .carousel .stage{position:relative; width:100%; aspect-ratio:16/9; background:#111;}
    .carousel .slide{position:absolute; inset:0; display:none;}
    .carousel .slide.active{display:block;}
    .carousel img{width:100%; height:100%; object-fit:cover; transition:transform .35s ease;}
    .carousel:hover .slide.active img{transform:scale(1.02);}
    .arrow{position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,.45); color:#fff; border:none; width:42px; height:42px; border-radius:50%; cursor:pointer; display:grid; place-items:center; font-size:18px;}
    .arrow:hover{background:rgba(0,0,0,.6);}
    .prev{left:10px}
    .next{right:10px}
    .dots{position:absolute; left:0; right:0; bottom:10px; display:flex; gap:8px; justify-content:center;}
    .dot{width:10px; height:10px; border-radius:50%; border:2px solid rgba(255,255,255,.9); background:rgba(255,255,255,.25); cursor:pointer;}
    .dot.active{background:#fff}
    .progress{position:absolute; left:0; right:0; bottom:0; height:4px; background:rgba(255,255,255,.18);}
    .progress .bar{height:100%; width:0%; background:linear-gradient(90deg,#5fb3ff,#1e90ff);}
    .caption{position:absolute; left:12px; bottom:12px; background:rgba(0,0,0,.42); color:#fff; font-size:14px; padding:6px 10px; border-radius:8px; max-width:min(80%, 800px); line-height:1.5;}
    .controls{position:absolute; right:10px; bottom:10px; display:flex; gap:8px;}
    .btn{background:rgba(0,0,0,.45); color:#fff; border:none; border-radius:10px; padding:6px 10px; font-size:13px; cursor:pointer;}
    .btn:hover{background:rgba(0,0,0,.6);}
  </style>
</head>
<body>
  <nav>
    <div class="brand">📘 UDM ESG 永續教科書</div>
    <div>
      <a href="index.html">🏠 首頁</a>
      <a href="sunshine.html">🌞 陽光</a>
      <a href="air.html">💨 空氣</a>
      <a href="water.html">💧 水</a>
      <a href="carbon.html">🌱 碳匯</a>
      <label class="switch">
        <input type="checkbox" id="darkToggle" aria-label="切換深色模式">
        <span class="slider"></span>
      </label>
      <!-- 新增：可點擊的文字標籤（與 water/index 對齊） -->
      <label class="switch-text" for="darkToggle">深色</label>
    </div>
  </nav>

  <main>
    <h1>🌱 碳匯：固碳原理與公式</h1>

    <section class="carousel" id="carbonCarousel" tabindex="0">
      <div class="stage">
        <div class="slide active"><img src="C1.png" alt="森林碳匯" data-caption="森林是重要碳匯：透過光合作用把 CO₂ 變成生物量。"></div>
        <div class="slide"><img src="C2.png" alt="草地碳匯" data-caption="草地與濕地把碳長期儲存在植物體與土壤中。"></div>
        <div class="slide"><img src="C3.png" alt="海洋碳匯" data-caption="海洋浮游植物每年吸收全球約四分之一 CO₂。"></div>
        <div class="slide"><img src="C4.png" alt="校園碳匯" data-caption="校園樹木調查可用 DBH 與樹高估算碳匯。"></div>
        <div class="slide"><img src="C5.png" alt="樹齡碳匯" data-caption="樹齡不同，年固碳量也不同，成長最快時吸收最多。"></div>
        <div class="slide"><img src="C6.png" alt="永續經營" data-caption="永續經營：保育、生產、教育三合一。"></div>
        <div class="slide"><img src="C7.png" alt="資料碳匯" data-caption="以資料驅動的碳匯盤點與教學活動。"></div>

        <button class="arrow prev" aria-label="上一張">‹</button>
        <button class="arrow next" aria-label="下一張">›</button>
        <div class="dots" aria-hidden="true"></div>
        <div class="controls"><button class="btn" id="togglePlay">⏸ 暫停</button></div>
        <div class="caption" id="caption">森林是重要碳匯：透過光合作用把 CO₂ 變成生物量。</div>
        <div class="progress"><div class="bar" id="progressBar"></div></div>
      </div>
    </section>

    <h2>📘 什麼是碳匯？</h2>
    <p>碳匯（Carbon Sink）是能夠吸收並儲存二氧化碳（CO₂）的自然或人工系統，是對抗氣候變遷的重要力量。</p>
    <ul>
      <li>🌳 森林：透過光合作用吸收 CO₂</li>
      <li>🌿 草地與濕地：儲存碳於植物體與土壤</li>
      <li>🌊 海洋：海藻與浮游植物也是重要碳匯</li>
    </ul>

    <h2>📊 固碳量與總固碳量</h2>
    <ul>
      <li><strong>年固碳量：</strong> 指樹木每年能吸收多少 CO₂，會隨樹齡與生長速率而變動。</li>
      <li><strong>總固碳量：</strong> 指一棵樹或一片林地至今為止吸收並固定的 CO₂ 總量。</li>
    </ul>

    <h2>📐 計算公式（簡化版）：</h2>
    <ul>
      <li><strong>生物量：</strong> Biomass = 0.15 × DBH<sup>2.27</sup></li>
      <li><strong>碳含量：</strong> Carbon = Biomass × 0.5</li>
      <li><strong>CO₂ 固定量：</strong> CO₂ = Carbon × 3.67</li>
      <li><strong>年固碳量：</strong> CO₂ ÷ 樹齡</li>
    </ul>
  </main>

  <script>
  // Dark mode toggle
  const darkToggle = document.getElementById("darkToggle");
  darkToggle?.addEventListener("change", ()=> document.body.classList.toggle("dark", darkToggle.checked));

  // Carousel
  (function(){
    const root = document.getElementById('carbonCarousel');
    if (!root) return;
    const slides = Array.from(root.querySelectorAll('.slide'));
    const prevBtn = root.querySelector('.prev');
    const nextBtn = root.querySelector('.next');
    const dotsWrap = root.querySelector('.dots');
    const progressBar = document.getElementById('progressBar');
    const caption = document.getElementById('caption');
    const togglePlayBtn = document.getElementById('togglePlay');

    const AUTOPLAY_MS = 4000;
    const DRAG_THRESHOLD = 40;
    let i = 0, timer = null, playing = true, startedAt=0;

    slides.forEach((_, idx)=>{
      const d=document.createElement('div');
      d.className='dot'+(idx===0?' active':'');
      d.addEventListener('click', ()=>{stop();go(idx);play();});
      dotsWrap.appendChild(d);
    });
    const dots=Array.from(dotsWrap.children);

    function setCaption(idx){
      const img=slides[idx].querySelector('img');
      caption.textContent=img?.dataset?.caption||img?.alt||'';
    }
    function go(n){
      slides[i].classList.remove('active');
      dots[i].classList.remove('active');
      i=(n+slides.length)%slides.length;
      slides[i].classList.add('active');
      dots[i].classList.add('active');
      setCaption(i);
      resetProgress();
    }
    function next(){go(i+1);}
    function prev(){go(i-1);}
    function resetProgress(){startedAt=performance.now(); progressBar.style.width='0%';}
    function tick(){
      if(!playing)return;
      const elapsed=performance.now()-startedAt;
      const p=Math.min(1,elapsed/AUTOPLAY_MS);
      progressBar.style.width=(p*100).toFixed(1)+'%';
      if(p>=1) next();
      timer=requestAnimationFrame(tick);
    }
    function play(){if(playing)return; playing=true; togglePlayBtn.textContent='⏸ 暫停'; resetProgress(); timer=requestAnimationFrame(tick);}
    function stop(){playing=false; togglePlayBtn.textContent='▶️ 播放'; cancelAnimationFrame(timer);}

    togglePlayBtn.addEventListener('click',()=>playing?stop():play());
    nextBtn.addEventListener('click',()=>{stop();next();play();});
    prevBtn.addEventListener('click',()=>{stop();prev();play();});
    root.addEventListener('mouseenter',stop);
    root.addEventListener('mouseleave',()=>{if(!playing)play();});
    document.addEventListener('visibilitychange',()=>{document.hidden?stop():play();});
    root.addEventListener('keydown',e=>{
      if(e.key==='ArrowRight'){stop();next();play();}
      if(e.key==='ArrowLeft'){stop();prev();play();}
      if(e.key===' '){e.preventDefault(); playing?stop():play();}
    });
    let startX=null,dragging=false;
    const stage=root.querySelector('.stage');
    const onPointerDown=e=>{dragging=true;startX=e.clientX??e.touches?.[0]?.clientX;stop();}
    const onPointerUp=e=>{
      if(!dragging)return;
      const endX=e.clientX??e.changedTouches?.[0]?.clientX;
      const dx=endX-startX; dragging=false;
      if(Math.abs(dx)>DRAG_THRESHOLD){dx<0?next():prev();}
      play();
    }
    stage.addEventListener('mousedown',onPointerDown);
    window.addEventListener('mouseup',onPointerUp);
    stage.addEventListener('touchstart',onPointerDown,{passive:true});
    stage.addEventListener('touchend',onPointerUp);

    setCaption(0);
    resetProgress();
    timer=requestAnimationFrame(tick);
  })();
  </script>
</body>
</html>
